#include "kb_state.h"
// #include "print.h"

extern keymap_config_t keymap_config;

void kb_state_render() {
    static const char PROGMEM images[][32] = {
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x7e, 0x42, 0x5a, 0x42, 0x00, 0x7e, 0x00, 0x50, 0x40, 0x00, 0x76, 0x08, 0x04, 0x52, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x52, 0x42, 0x42, 0x52, 0x72, 0x06, 0x60, 0x4e, 0x4a, 0x42, 0x42, 0x4a, 0x7a},
        {0x7e, 0x42, 0x5a, 0x42, 0x00, 0x7e, 0x00, 0x50, 0x40, 0x00, 0x76, 0x08, 0x04, 0x52, 0x00, 0x00, 0x00, 0x00, 0x5e, 0x52, 0x42, 0x42, 0x52, 0x72, 0x06, 0x60, 0x4e, 0x4a, 0x42, 0x42, 0x4a, 0x7a},
    };

    oled_set_cursor(0, 15);
    oled_write_raw_P(images[host_keyboard_led_state().caps_lock + keymap_config.nkro * 2], sizeof(images[0]));

    uint8_t wpm = get_current_wpm();
    for (char i = 0; i < 8; i++) {
        uint8_t x   = (i % 4) * 9;
        uint8_t y   = 90 + (i >= 4) * 12;
        bool    bit = (wpm & (1 << i)) >> i;

        oled_write_pixel(x + 2, y, bit);
        oled_write_pixel(x + 1, y + 1, bit);
        oled_write_pixel(x + 3, y + 1, bit);
        oled_write_pixel(x, y + 2, bit);
        oled_write_pixel(x + 4, y + 2, bit);
        oled_write_pixel(x + 1, y + 3, bit);
        oled_write_pixel(x + 3, y + 3, bit);
        oled_write_pixel(x + 2, y + 4, bit);

        oled_write_pixel(x + 2, y + 1, bit);
        oled_write_pixel(x + 1, y + 2, bit);
        oled_write_pixel(x + 2, y + 2, 1);
        oled_write_pixel(x + 3, y + 2, bit);
        oled_write_pixel(x + 2, y + 3, bit);
    }
    // oled_set_cursor(3, 15);
    // oled_write_raw_P(images[keymap_config.nkro ? 2 : 0], sizeof(images[0]));
}
